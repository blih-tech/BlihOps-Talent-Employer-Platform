// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum TalentStatus {
  PENDING
  APPROVED
  REJECTED
  HIRED
  INACTIVE
}

enum JobStatus {
  PENDING
  PUBLISHED
  REJECTED
  CLOSED
  ARCHIVED
}

enum ApplicationStatus {
  NEW
  SHORTLISTED
  HIRED
  REJECTED
}

enum ServiceCategory {
  ITO
  AI
  AUTOMATION
  DATA_ANALYTICS
}

enum ExperienceLevel {
  ENTRY
  INTERMEDIATE
  SENIOR
  EXPERT
}

enum EngagementType {
  FULL_TIME
  PART_TIME
  CONTRACT
  FREELANCE
  INTERNSHIP
}

// Models
model Talent {
  id            String          @id @default(uuid())
  telegramId    String          @unique
  name          String
  serviceCategory ServiceCategory
  skills        String[]        // Array of skills
  experienceLevel ExperienceLevel
  yearsOfExperience Int?
  bio           String?
  cvUrl         String?
  status        TalentStatus    @default(PENDING)
  metadata      Json?           // JSONB for flexible data
  
  // Relationships
  applications  Application[]
  
  // Timestamps
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  
  // Indexes
  @@index([telegramId])
  @@index([status])
  @@index([serviceCategory])
  @@index([skills], type: Gin)
}

model Job {
  id              String          @id @default(uuid())
  title           String
  description     String
  serviceCategory ServiceCategory
  requiredSkills  String[]        // Array of required skills
  experienceLevel ExperienceLevel
  engagementType  EngagementType
  duration        String?
  budget          String?
  status          JobStatus       @default(PENDING)
  metadata        Json?           // JSONB for flexible data
  
  // Relationships
  createdById     String
  createdBy       Admin           @relation(fields: [createdById], references: [id])
  applications    Application[]
  
  // Timestamps
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  publishedAt     DateTime?
  closedAt        DateTime?
  
  // Indexes
  @@index([status])
  @@index([serviceCategory])
  @@index([createdById])
  @@index([requiredSkills], type: Gin)
}

model Application {
  id              String            @id @default(uuid())
  
  // Relationships
  jobId           String
  job             Job               @relation(fields: [jobId], references: [id])
  talentId        String
  talent          Talent            @relation(fields: [talentId], references: [id])
  
  status          ApplicationStatus @default(NEW)
  matchScore      Float?            // 0-100
  matchBreakdown  Json?             // JSONB with score details
  notes           String?
  
  // Timestamps
  appliedAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  shortlistedAt   DateTime?
  hiredAt         DateTime?
  rejectedAt      DateTime?
  
  // Indexes
  @@unique([jobId, talentId])
  @@index([jobId])
  @@index([talentId])
  @@index([status])
  @@index([matchScore])
}

model Admin {
  id              String    @id @default(uuid())
  email           String    @unique
  passwordHash    String
  name            String
  role            String    @default("ADMIN")
  telegramIds     String[]  // Array of authorized Telegram IDs
  preferences     Json?
  
  // Relationships
  jobs            Job[]
  auditLogs       AuditLog[]
  
  // Timestamps
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Indexes
  @@index([email])
}

model AuditLog {
  id              String    @id @default(uuid())
  
  // Relationships
  adminId         String
  admin           Admin     @relation(fields: [adminId], references: [id])
  
  action          String    // e.g., "APPROVE_TALENT", "PUBLISH_JOB"
  resourceType    String    // e.g., "TALENT", "JOB"
  resourceId      String
  metadata        Json?     // JSONB with action details
  
  // Timestamps
  createdAt       DateTime  @default(now())
  
  // Indexes
  @@index([adminId])
  @@index([resourceType, resourceId])
  @@index([createdAt])
}
